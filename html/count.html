<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ç§’æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ï¼ˆèª­ã¿ä¸Šã’ä»˜ãï¼‰</title>
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/header.css" />
  </head>
  <body>
    <header class="header">
      <a href="index.html" class="header__logo"> QDT47 </a>
      <div id="menuToggle" class="menu-toggle">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
      </div>
    </header>
    <nav id="sideMenu" class="side-menu">
      <ul class="side-menu__list">
        <li class="side-menu__item"><a href="index.html">ğŸ¡ ãƒ›ãƒ¼ãƒ </a></li>
        <li class="side-menu__item">
          <a href="0.5s.html">â±ï¸ 0.5ç§’æ¯ã‚«ã‚¦ãƒ³ãƒˆ</a>
        </li>
        <li class="side-menu__item">
          <a href="0.8s.html">â±ï¸ 0.8ç§’æ¯ã‚«ã‚¦ãƒ³ãƒˆ</a>
        </li>
        <li class="side-menu__item"><a href="1s.html">â±ï¸ 1ç§’æ¯ã‚«ã‚¦ãƒ³ãƒˆ</a></li>
        <li class="side-menu__item">
          <a href="1-5s.html">â±ï¸ 1.5ç§’æ¯ã‚«ã‚¦ãƒ³ãƒˆ</a>
        </li>
        <li class="side-menu__item"><a href="2s.html">â±ï¸ 2ç§’æ¯ã‚«ã‚¦ãƒ³ãƒˆ</a></li>
        <li class="side-menu__item"><a href="3s.html">â±ï¸ 3ç§’æ¯ã‚«ã‚¦ãƒ³ãƒˆ</a></li>
        <li class="side-menu__item">
          <a href="count.html">â±ï¸ ç§’æ•°ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ã‚¤ãƒ³</a>
        </li>
        <li class="side-menu__item">
          <a href="message.html">ğŸ’¬ å¥®ã„ç«‹ã¤åè¨€é›†</a>
        </li>
        <li class="side-menu__item">
          <a href="movie.html">ğŸ’ª ã‚„ã‚‹æ°—UPå‹•ç”»</a>
        </li>
      </ul>
    </nav>
    <h1>é€£ç¶šã‚«ã‚¦ãƒ³ãƒˆï¼ˆ1ç§’ã”ã¨ï¼‰</h1>
    <p id="counter">00:00</p>
    <div>
      <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="stopBtn">ã‚¹ãƒˆãƒƒãƒ—</button>
      <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <script>
      let totalSeconds = 0;
      let intervalId;
      let countdownId; // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç”¨ã®IDã‚’è¿½åŠ 
      let isRunning = false;
      const COUNTER_RATE = 2.0; // èª­ã¿ä¸Šã’é€Ÿåº¦

      // éŸ³å£°èª­ã¿ä¸Šã’é–¢æ•°
      function speak(text) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = "ja-JP";
        utterance.rate = COUNTER_RATE; // é«˜é€Ÿã§èª­ã¿ä¸Šã’
        speechSynthesis.speak(utterance);
      }

      // ç§’æ•°ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¦èª­ã¿ä¸Šã’ã‚‹é–¢æ•° (1åˆ†çµŒéå¾Œã¯ã€Œåˆ† ç§’ã€å½¢å¼)
      function speakTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;

        let textToSpeak = "";

        if (h > 0) {
          textToSpeak = `${h}æ™‚é–“ ${m}åˆ† ${s}ç§’`;
        } else if (m > 0) {
          // 1åˆ†ä»¥ä¸Šã®å ´åˆï¼šã€ŒXåˆ†ã€‚ Yã€ã®ã‚ˆã†ã«ã€é–“ï¼ˆå¥ç‚¹ï¼‰ã‚’ç©ºã‘ã¦é«˜é€Ÿã«èª­ã¿ä¸Šã’
          textToSpeak = `${m}åˆ†ã€‚ ${s}`;
        } else {
          // 1åˆ†æœªæº€ã®å ´åˆï¼šç§’æ•°ã‚’ãã®ã¾ã¾èª­ã¿ä¸Šã’
          textToSpeak = `${s}`;
        }

        speechSynthesis.cancel();
        speak(textToSpeak);
      }

      // ç”»é¢è¡¨ç¤ºã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹é–¢æ•° (H:MM:SS ã¾ãŸã¯ MM:SS)
      function formatTime(seconds) {
        const h = Math.floor(seconds / 3600);
        const m = Math.floor((seconds % 3600) / 60);
        const s = seconds % 60;
        const pad = (num) => String(num).padStart(2, "0");

        if (h > 0) {
          return `${h}:${pad(m)}:${pad(s)}`;
        } else {
          return `${pad(m)}:${pad(s)}`;
        }
      }

      // â˜…â˜…â˜… ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—å‡¦ç†æœ¬ä½“ â˜…â˜…â˜…
      function startInterval() {
        totalSeconds = 0;
        document.getElementById("counter").textContent =
          formatTime(totalSeconds);
        speak("ã‚¹ã‚¿ãƒ¼ãƒˆï¼");
        isRunning = true;

        intervalId = setInterval(() => {
          totalSeconds++;
          document.getElementById("counter").textContent =
            formatTime(totalSeconds);
          speakTime(totalSeconds);
        }, 1000);
      }

      // â˜…â˜…â˜… ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç† â˜…â˜…â˜…
      function startCounting() {
        if (isRunning) return;

        clearInterval(intervalId);
        clearInterval(countdownId);
        speechSynthesis.cancel();

        // 1. ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã®é–‹å§‹ã‚’å®£è¨€
        speak("10ç§’å¾Œã«ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™");

        // 2. 0.5ç§’å¾Œã‹ã‚‰ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
        setTimeout(() => {
          let countdown = 10;
          document.getElementById("counter").textContent = countdown;
          speak(countdown); // æœ€åˆã®ã€Œ10ã€ã‚’èª­ã¿ä¸Šã’

          countdownId = setInterval(() => {
            countdown--;
            document.getElementById("counter").textContent = countdown;

            if (countdown > 0) {
              speak(countdown);
            } else {
              clearInterval(countdownId);
              // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³çµ‚äº†å¾Œã€ãƒ¡ã‚¤ãƒ³ã®ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹
              startInterval();
            }
          }, 1000);
        }, 500); // 0.5ç§’é…å»¶
      }

      function stopCounting() {
        if (!isRunning) return;

        clearInterval(intervalId);
        clearInterval(countdownId); // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ã‚‚åœæ­¢ã§ãã‚‹ã‚ˆã†ã«
        isRunning = false;

        // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ä¸­ã ã£ãŸå ´åˆã€æœ€çµ‚æ™‚é–“ã‚’èª­ã¿ä¸Šã’ã‚‹
        if (totalSeconds > 0) {
          speak(`ã‚¹ãƒˆãƒƒãƒ—ã€‚ç¾åœ¨ã®ã‚¿ã‚¤ãƒ ã¯ ${formatTime(totalSeconds)} ã§ã™ã€‚`);
        } else {
          speechSynthesis.cancel(); // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ãªã‚‰å˜ã«åœæ­¢
        }
      }

      function resetCounting() {
        clearInterval(intervalId);
        clearInterval(countdownId);
        speechSynthesis.cancel();
        isRunning = false;
        totalSeconds = 0;
        document.getElementById("counter").textContent = "00:00";
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("counter").textContent =
          formatTime(totalSeconds);
        document
          .getElementById("startBtn")
          .addEventListener("click", startCounting);
        document
          .getElementById("stopBtn")
          .addEventListener("click", stopCounting);
        document
          .getElementById("resetBtn")
          .addEventListener("click", resetCounting);
      });
    </script>
    <script src="../js/script.js"></script>
  </body>
</html>
